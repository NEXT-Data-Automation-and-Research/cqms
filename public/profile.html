<!DOCTYPE html>
<html lang="en">
<head>
  <script src="/js/console-stub.js"></script>
  <meta charset="UTF-8">
  <title>Profile | QMS</title>
  <meta name="description" content="Quality Management System - User Profile">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjMWY5ZTRiIj48cGF0aCBkPSJNMjAwLTEyMHEtMzMgMC01Ni41LTIzLjVUMTIwLTIwMHYtNTYwcTAtMzMgMjMuNS01Ni41VDIwMC04NDBoNTYwcTMzIDAgNTYuNSAyMy41VDg0MC03NjB2NTYwcTAgMzMtMjMuNSA1Ni41VDc2MC0xMjBIMjAwWm00OTEtODBoNjl2LTY5bC02OSA2OVptLTQ1NyAwaDczbDEyMC0xMjBoODVMNDUyLTIwMGg2NGwxMjAtMTIwaDg1TDU0MS0yMDBoNjVsMTIwLTEyMGgzNHYtNDQwSDIwMHY1MDlsNjktNjloODVMNDM0LTIwMFptNzItMjAwLTU2LTU2IDE3Ny0xNzcgODAgODAgMTQ3LTE0NyA1NiA1Ni0yMDMgMjA0LTgwLTgwLTEyMSAxMjBaIi8+PC9zdmc+">
  
  <!-- Global Styles -->
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/theme.css">
  <link rel="stylesheet" href="/sidebar.css">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: 'var(--home-primary-500, #635BFF)',
            'primary-dark': 'var(--home-primary-700, #4d42d1)',
            'dark-forest': 'var(--home-background, #100A28)',
            'success': 'var(--color-success)',
            'warning': 'var(--color-warning)',
            'error': 'var(--color-error)',
          },
          fontFamily: {
            sans: ['var(--font-family-primary)', 'sans-serif'],
          },
        },
      },
    }
  </script>
  
  <!-- Import map for npm packages in browser -->
  <script type="importmap">
  {
    "imports": {
      "loglevel": "https://cdn.jsdelivr.net/npm/loglevel@1.9.1/+esm",
      "@supabase/supabase-js": "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/+esm",
      "dompurify": "https://cdn.jsdelivr.net/npm/dompurify@3.3.1/+esm"
    }
  }
  </script>
</head>

<body class="home-page">
  <!-- Sidebar will be loaded dynamically by load-sidebar.js -->
  <main class="main-content" role="main">
    <!-- Header Component -->
    <div id="header-container"></div>

    <!-- Main Content -->
    <div class="px-4 py-4 max-w-7xl mx-auto w-full">
      <!-- Profile content will be loaded here -->
      <div id="profile-container">
        <div class="flex items-center justify-center min-h-[400px]">
          <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
            <p class="text-gray-600">Loading profile...</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Authentication Guard -->
  <script type="module" src="/js/auth-checker.js"></script>
  
  <!-- Sidebar Loader -->
  <script type="module" src="/js/load-sidebar.js" defer></script>

  <!-- Profile Controller -->
  <script type="module">
    import { ProfileController } from '/js/features/profile/presentation/profile-controller.js';
    
    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeProfile);
    } else {
      initializeProfile();
    }

    async function initializeProfile() {
      try {
        const controller = new ProfileController();
        await controller.initialize();
        
        // Make controller available globally for sidebar refresh
        window.profileController = controller;
      } catch (error) {
        console.error('Failed to initialize profile:', error);
        const container = document.getElementById('profile-container');
        if (container) {
          container.innerHTML = `
            <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg">
              Failed to load profile. Please refresh the page.
            </div>
          `;
        }
      }
    }
  </script>
</body>
</html>

