<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Auditors' Dashboard | QMS</title>
  <meta name="description" content="Quality Management System - Auditors' Dashboard">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjMWY5ZTRiIj48cGF0aCBkPSJNMjAwLTEyMHEtMzMgMC01Ni41LTIzLjVUMTIwLTIwMHYtNTYwcTAtMzMgMjMuNS01Ni41VDIwMC04NDBoNTYwcTMzIDAgNTYuNSAyMy41VDg0MC03NjB2NTYwcTAgMzMtMjMuNSA1Ni41VDc2MC0xMjBIMjAwWm00OTEtODBoNjl2LTY5bC02OSA2OVptLTQ1NyAwaDczbDEyMC0xMjBoODVMNDUyLTIwMGg2NGwxMjAtMTIwaDg1TDU0MS0yMDBoNjVsMTIwLTEyMGgzNHYtNDQwSDIwMHY1MDlsNjktNjloODVMNDM0LTIwMFptNzItMjAwLTU2LTU2IDE3Ny0xNzcgODAgODAgMTQ3LTE0NyA1NiA1Ni0yMDMgMjA0LTgwLTgwLTEyMSAxMjBaIi8+PC9zdmc+">
  
  <!-- External Dependencies -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Global Styles -->
  <link rel="stylesheet" href="/theme.css">
  <link rel="stylesheet" href="/sidebar.css">
  
  <!-- Feature Styles -->
  <link rel="stylesheet" href="/src/features/dashboard/presentation/styles/auditor-dashboard.css">
  
  <!-- External Scripts -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <!-- Core Scripts -->
  <script src="/env-config.js"></script>
  <script src="/supabase-config.js"></script>
  <script src="/auth-check.js"></script>
  <script src="/access-control.js"></script>
  <script src="/confirmation-dialog.js"></script>
  <script type="module" src="/js/load-sidebar.js"></script>
  <script src="/dark-mode.js"></script>
  <script src="/search.js"></script>
  <script src="/form-validation.js"></script>
  <script src="/timezone-utils.js"></script>
  <script src="/date-filter-utils.js"></script>
</head>

<body>
  <!-- Sidebar will be loaded dynamically by load-sidebar.js -->
  <main class="main-content" role="main">
    <p class="page-heading">Auditors' Dashboard</p>
    <div style="margin-bottom: var(--spacing-lg, 1.125rem); width: 100%;"></div>

    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <div class="tab-slider"></div>
      <button class="tab-button active" data-tab="team-stats">Team Stats</button>
      <button class="tab-button" data-tab="standup-view">Standup View</button>
    </div>

    <!-- Filters Component -->
    <div id="filtersContainer"></div>

    <!-- Stats Cards Component -->
    <div id="statsContainer"></div>

    <!-- Performance Table -->
    <div id="performanceTable" class="performance-table">
      <div class="performance-table-header">
        <h3 class="performance-table-title">Progress Overview</h3>
      </div>
      <div class="performance-table-content">
        <div id="tableHeader" class="performance-table-grid" style="grid-template-columns: minmax(5.2734rem, 2fr) minmax(3.5156rem, 1fr) minmax(3.5156rem, 1fr) minmax(3.5156rem, 1fr) minmax(4.5rem, 1.2fr) minmax(7.0312rem, 2fr);">
          <div>Name</div>
          <div style="text-align: center;">Assigned</div>
          <div style="text-align: center;">Completed</div>
          <div style="text-align: center;">Remaining</div>
          <div style="text-align: center;">Avg Duration</div>
          <div style="text-align: center;">Progress Meter</div>
        </div>
        <div id="performanceTableBody" style="min-width: fit-content;">
          <div class="loading-indicator">
            <div class="loading-spinner"></div>
            <div style="margin-top: var(--spacing-md); font-size: var(--font-xs);">Loading...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Dynamic Hourly Breakdown -->
    <div id="dynamicHourlyBreakdownTable" class="hourly-breakdown-container" style="display: none;">
      <div class="performance-table-header">
        <h3 class="performance-table-title">Dynamic/Realtime Hourly Breakdown</h3>
      </div>
      <div class="hourly-content">
        <div style="min-height: 20rem; position: relative;">
          <canvas id="dynamicHourlyChart"></canvas>
        </div>
        <div style="overflow-x: auto;">
          <div id="dynamicHourlyTableBody" style="min-width: fit-content;">
            <div class="loading-indicator">Loading...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Hourly Breakdown -->
    <div id="hourlyBreakdownTable" class="hourly-breakdown-container" style="display: none;">
      <div class="performance-table-header">
        <h3 class="performance-table-title">Hourly Breakdown</h3>
      </div>
      <div class="hourly-content">
        <div style="min-height: 20rem; position: relative;">
          <canvas id="hourlyChart"></canvas>
        </div>
        <div style="overflow-x: auto;">
          <div id="hourlyTableBody" style="min-width: fit-content;">
            <div class="loading-indicator">Loading...</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Load Components -->
  <script type="module">
    // Load HTML components
    async function loadComponent(url, containerId) {
      try {
        const response = await fetch(url);
        const html = await response.text();
        const container = document.getElementById(containerId);
        if (container) {
          container.innerHTML = html;
        }
      } catch (error) {
        console.error(`Error loading component ${url}:`, error);
      }
    }

    // Load components
    await Promise.all([
      loadComponent('/src/features/dashboard/presentation/components/auditor-dashboard-filters.html', 'filtersContainer'),
      loadComponent('/src/features/dashboard/presentation/components/auditor-dashboard-stats.html', 'statsContainer')
    ]);

    // Initialize dashboard controller
    import { auditorDashboardController } from '/js/features/dashboard/application/auditor-dashboard-controller.js';
    
    // Make controller available globally for event handlers
    window.auditorDashboardController = auditorDashboardController;
    window.auditorDashboardState = auditorDashboardController.state;

    // Initialize on DOM ready
    document.addEventListener('DOMContentLoaded', async () => {
      await auditorDashboardController.initialize();
    });

    // Cleanup on page unload
    window.addEventListener('beforeunload', async () => {
      await auditorDashboardController.cleanup();
    });
  </script>
</body>
</html>

