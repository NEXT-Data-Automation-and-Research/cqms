<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign in | QMS</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjMWY5ZTRiIj48cGF0aCBkPSJNMjAwLTEyMHEtMzMgMC01Ni41LTIzLjVUMTIwLTIwMHYtNTYwcTAtMzMgMjMuNS01Ni41VDIwMC04NDBoNTYwcTMzIDAgNTYuNSAyMy41VDg0MC03NjB2NTYwcTAgMzMtMjMuNSA1Ni41VDc2MC0xMjBIMjAwWm00OTEtODBoNjl2LTY5bC02OSA2OVptLTQ1NyAwaDczbDEyMC0xMjBoODVMNDUyLTIwMGg2NGwxMjAtMTIwaDg1TDU0MS0yMDBoNjVsMTIwLTEyMGgzNHYtNDQwSDIwMHY1MDlsNjktNjloODVMNDM0LTIwMFptNzItMjAwLTU2LTU2IDE3Ny0xNzcgODAgODAgMTQ3LTE0NyA1NiA1Ni0yMDMgMjA0LTgwLTgwLTEyMSAxMjBaIi8+PC9zdmc+">
    <link rel="stylesheet" href="/styles.css">
    <script type="importmap">
    {"imports":{"loglevel":"https://cdn.jsdelivr.net/npm/loglevel@1.9.1/+esm","@supabase/supabase-js":"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/+esm","dompurify":"https://cdn.jsdelivr.net/npm/dompurify@3.3.1/+esm"}}
    </script>
    <style>
        /* Typewriter cursor */
        #typewriterCursor { animation: blink 0.8s step-end infinite; }
        @keyframes blink { 50% { opacity: 0; } }
        /* Luxury section typography */
        .font-display { font-family: ui-serif, Georgia, Cambria, 'Times New Roman', serif; }
        /* Scroll indicator: gentle bounce down */
        #scrollIndicator { animation: scrollBounce 2s ease-in-out infinite; }
        @keyframes scrollBounce {
            0%, 100% { transform: translateY(0); opacity: 1; }
            50% { transform: translateY(8px); opacity: 0.85; }
        }
        /* First section: exactly one viewport so scroll icon is always visible at 100% zoom */
        .auth-viewport {
            height: 100vh;
            height: 100dvh;
            max-height: 100vh;
            max-height: 100dvh;
        }
        /* Hero "Every Detail Matters." – explicit font-size so it applies (avoids Tailwind purge/build issues) */
        #typewriterHeading {
            font-size: 5rem;
        }
        @media (min-width: 640px) {
            #typewriterHeading { font-size: 5rem; }
        }
        @media (min-width: 1280px) {
            #typewriterHeading { font-size: 5rem; }
        }
    </style>
</head>
<body class="min-h-screen antialiased">
    <!-- Fixed viewport: only login visible on load; height = viewport so scroll icon is visible at 100% zoom -->
    <section class="auth-viewport relative flex overflow-hidden shrink-0" aria-label="Sign in">
    <div class="min-h-0 flex-1 w-full flex overflow-hidden">
        <!-- Left: Brand -->
        <div class="hidden lg:flex lg:w-[70%] lg:min-w-0 flex-col justify-between bg-[#1A733E] p-6 lg:p-10 xl:p-14 overflow-hidden">
            <div class="min-h-0 flex-shrink">
                <h1 id="typewriterHeading" class="font-extrabold tracking-tight text-[#E0FFB3] leading-[1.1] min-h-[1.2em]">
                    <span id="typewriterText"></span><span id="typewriterCursor" aria-hidden="true">|</span>
                </h1>
                <p id="typewriterSubline" class="mt-3 text-[#E0FFB3] text-base opacity-0 translate-y-4 transition-all duration-700 ease-out">The art of perfection begins here.</p>
            </div>
            <div class="flex flex-col gap-1 items-start flex-shrink-0">
                <img src="https://careers.recruiteecdn.com/image/upload/production/images/BpRN/wCefCTnrj5fG.png" alt="NEXT Ventures" class="h-8 w-auto object-contain object-left opacity-90 -ml-[0.4rem]" width="160" height="32" loading="lazy">
                <p class="text-[#E0FFB3] text-sm xl:text-base font-bold">Communications Quality Management System</p>
            </div>
        </div>

        <!-- Right: Sign in (full width on mobile, left panel hidden) -->
        <div class="flex-1 min-w-0 min-h-0 flex flex-col lg:flex-row lg:items-center lg:justify-center bg-[#F6F5F0] p-4 sm:p-6 lg:p-10 overflow-auto">
            <!-- Mobile: minimal brand -->
            <div class="lg:hidden mb-4 sm:mb-6 flex justify-start flex-shrink-0">
                <img src="https://careers.recruiteecdn.com/image/upload/production/images/BpRN/wCefCTnrj5fG.png" alt="NEXT Ventures" class="h-7 w-auto object-contain object-left opacity-80" width="140" height="28" loading="eager">
            </div>
            <div class="w-full max-w-[360px] lg:mx-0 mx-auto text-center flex-shrink-0">
                <h2 class="text-xl sm:text-2xl font-semibold text-slate-900 tracking-tight">Sign in</h2>
                <p class="mt-1 text-slate-500 text-sm">Use your work account to continue.</p>

                <form id="loginForm" class="mt-4 sm:mt-6 lg:mt-8">
                    <div class="space-y-4 flex flex-col items-center">
                        <button
                            type="button"
                            id="googleSignInButton"
                            class="w-auto min-w-[240px] flex items-center justify-center gap-3 rounded-full border border-[#dadce0] bg-white py-2.5 px-5 text-sm font-bold text-black transition hover:bg-[#f8f9fa] focus:outline-none focus:ring-2 focus:ring-[#1a73e8]/30 disabled:opacity-60">
                            <svg class="h-5 w-5 flex-shrink-0" viewBox="0 0 18 18" fill="none" aria-hidden="true">
                                <path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z" fill="#4285F4"/>
                                <path d="M9 18c2.43 0 4.467-.806 5.965-2.184l-2.908-2.258c-.806.54-1.837.86-3.057.86-2.35 0-4.34-1.587-5.053-3.72H.957v2.332C2.438 15.983 5.482 18 9 18z" fill="#34A853"/>
                                <path d="M3.947 10.698c-.18-.54-.282-1.117-.282-1.698s.102-1.158.282-1.698V4.97H.957C.348 6.175 0 7.55 0 9s.348 2.825.957 4.03l2.99-2.332z" fill="#FBBC05"/>
                                <path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.97L3.947 7.302C4.66 5.167 6.65 3.58 9 3.58z" fill="#EA4335"/>
                            </svg>
                            <span id="googleButtonContent">Sign in with Google</span>
                        </button>
                        <p id="googleError" class="text-sm text-red-600 empty:hidden text-center"></p>
                    </div>
                </form>

                <!-- Dev bypass (shown only in dev) -->
                <div id="devBypassSection" class="mt-8 hidden rounded-lg border border-dashed border-slate-300 bg-slate-100/50 p-4">
                    <p class="text-xs font-medium text-slate-500">Dev: Bypass auth</p>
                    <input type="email" id="devEmailInput" value="dev@test.com" class="mt-2 w-full rounded border border-slate-200 px-3 py-2 text-sm" placeholder="Email">
                    <button type="button" id="devBypassButton" class="mt-2 w-full rounded-lg bg-slate-700 px-3 py-2 text-sm font-medium text-white hover:bg-slate-800">Bypass (dev only)</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Scroll indicator: overlay layer at bottom center; always visible because section height = viewport -->
    <div class="absolute inset-0 pointer-events-none z-10 flex items-end justify-center pb-4 flex-shrink-0" aria-hidden="true">
        <a href="#features" id="scrollIndicator" class="pointer-events-auto flex flex-col items-center text-black/50 hover:text-black/60 focus:outline-none focus-visible:ring-2 focus-visible:ring-black/30 focus-visible:ring-offset-2 focus-visible:ring-offset-[#F6F5F0] rounded-full transition-colors shrink-0" aria-label="Scroll down to learn more">
            <svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48" fill="currentColor" class="w-9 h-9 sm:w-10 sm:h-10 lg:w-12 lg:h-12" aria-hidden="true"><path d="M481-350q-8 0-14.5-2.5T455-361L255-561q-11-10-10.5-25.5T256-613q11-10 26-10t26 10l173 174 173-174q11-10 25.5-9.5T705-612q11 11 11 26.5T705-560L506-361q-5 6-11.5 8.5T481-350Z"/></svg>
        </a>
    </div>
    </section>

    <!-- Features: luxury showcase below the fold (theme: cream + green) -->
    <section id="features" class="relative bg-[#F6F5F0] text-slate-900 overflow-hidden" aria-label="Platform features">
        <!-- Subtle grid texture -->
        <div class="absolute inset-0 opacity-[0.04]" style="background-image: linear-gradient(#1A733E 1px, transparent 1px), linear-gradient(90deg, #1A733E 1px, transparent 1px); background-size: 64px 64px;"></div>

        <div class="relative max-w-7xl mx-auto px-6 sm:px-10 py-24 lg:py-32">
            <!-- Section label -->
            <p class="font-display text-[#1A733E] text-sm uppercase tracking-[0.35em] mb-4">Why QMS</p>
            <h2 class="font-display text-4xl sm:text-5xl lg:text-6xl font-normal tracking-tight text-slate-900 max-w-3xl leading-[1.15]">
                Where quality meets clarity.
            </h2>
            <p class="mt-6 text-lg text-slate-600 max-w-xl leading-relaxed">
                One platform to audit, measure, and elevate every communication. Built for teams that refuse to compromise.
            </p>

            <!-- Feature blocks -->
            <div class="mt-20 lg:mt-28 grid gap-px sm:grid-cols-2 lg:grid-cols-3 bg-[#1A733E]/10 rounded-2xl overflow-hidden border border-[#1A733E]/20">
                <article class="group bg-white hover:bg-[#1A733E] p-8 lg:p-10 flex flex-col border border-slate-200/80 hover:border-[#1A733E] transition-colors duration-300">
                    <div class="w-12 h-12 rounded-xl bg-[#1A733E]/15 group-hover:bg-white/20 flex items-center justify-center mb-6 transition-colors duration-300">
                        <svg class="w-6 h-6 text-[#1A733E] group-hover:text-white transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
                    </div>
                    <h3 class="font-display text-xl lg:text-2xl text-slate-900 group-hover:text-white font-medium transition-colors duration-300">Quality Audits</h3>
                    <p class="mt-3 text-slate-600 group-hover:text-white text-sm lg:text-base leading-relaxed transition-colors duration-300">Structured evaluations with clear criteria. Score calls, emails, and interactions—then act on what matters.</p>
                </article>
                <article class="group bg-white hover:bg-[#1A733E] p-8 lg:p-10 flex flex-col border border-slate-200/80 hover:border-[#1A733E] transition-colors duration-300">
                    <div class="w-12 h-12 rounded-xl bg-[#1A733E]/15 group-hover:bg-white/20 flex items-center justify-center mb-6 transition-colors duration-300">
                        <svg class="w-6 h-6 text-[#1A733E] group-hover:text-white transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                    </div>
                    <h3 class="font-display text-xl lg:text-2xl text-slate-900 group-hover:text-white font-medium transition-colors duration-300">Reporting & Analytics</h3>
                    <p class="mt-3 text-slate-600 group-hover:text-white text-sm lg:text-base leading-relaxed transition-colors duration-300">Dashboards and trends at a glance. From team performance to compliance—decisions backed by data.</p>
                </article>
                <article class="group bg-white hover:bg-[#1A733E] p-8 lg:p-10 flex flex-col sm:col-span-2 lg:col-span-1 border border-slate-200/80 hover:border-[#1A733E] transition-colors duration-300">
                    <div class="w-12 h-12 rounded-xl bg-[#1A733E]/15 group-hover:bg-white/20 flex items-center justify-center mb-6 transition-colors duration-300">
                        <svg class="w-6 h-6 text-[#1A733E] group-hover:text-white transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                    </div>
                    <h3 class="font-display text-xl lg:text-2xl text-slate-900 group-hover:text-white font-medium transition-colors duration-300">Communications Hub</h3>
                    <p class="mt-3 text-slate-600 group-hover:text-white text-sm lg:text-base leading-relaxed transition-colors duration-300">Centralize every channel. Review, tag, and improve how your team communicates—internally and with customers.</p>
                </article>
            </div>

            <!-- Bottom line -->
            <div class="mt-20 lg:mt-24 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-6 pt-12 border-t border-[#1A733E]/20">
                <p class="font-display text-2xl sm:text-3xl text-[#1A733E]">Every detail matters.</p>
                <p class="text-slate-600 text-sm max-w-md">NEXT Ventures · Communications Quality Management System</p>
            </div>
        </div>
    </section>

    <!-- Hidden forms for script compatibility -->
    <form id="resetForm" class="hidden" aria-hidden="true">
        <div id="messageContainer"></div>
        <input type="email" id="resetEmail" placeholder="Email">
        <button type="submit" id="submitReset">Send reset link</button>
        <a href="#" id="backToLogin">Back to login</a>
    </form>

    <script type="module">
        /* Typewriter: "Every detail" then "matters." – one letter at a time */
        (function runTypewriter() {
            const textEl = document.getElementById('typewriterText');
            const cursorEl = document.getElementById('typewriterCursor');
            if (!textEl || !cursorEl) return;
            const line1 = 'Every Detail';
            const line2 = 'Matters.';
            const full = line1 + '\n' + line2;
            let i = 0;
            const ms = 85;
            function type() {
                if (i < full.length) {
                    textEl.innerHTML += full[i] === '\n' ? '<br>' : full[i];
                    i++;
                    setTimeout(type, ms);
                } else {
                    cursorEl.style.display = 'none';
                    const sub = document.getElementById('typewriterSubline');
                    if (sub) sub.classList.add('opacity-100', 'translate-y-0');
                }
            }
            setTimeout(type, 400);
        })();

        import { initSupabase, getSupabase } from '/js/utils/supabase-init.js';
        import { signInWithGoogle, handleGoogleOAuthCallback, enableDevBypassAuthentication } from '/js/utils/auth.js';

        function isDevModeEnabled() {
            const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.hostname.endsWith('.local');
            const urlParams = new URLSearchParams(window.location.search);
            const isDevMode = isLocalhost && (urlParams.get('dev') === 'true' || localStorage.getItem('isDev') === 'true' || (typeof window.DEV_MODE !== 'undefined' && window.DEV_MODE === true));
            if (isDevMode) console.log('[Auth] Dev mode enabled');
            return isDevMode;
        }

        const isDev = isDevModeEnabled();
        if (isDev) {
            const el = document.getElementById('devBypassSection');
            if (el) el.classList.remove('hidden');
        }

        let supabaseInitialized = false;
        async function initializeSupabase() {
            try {
                await initSupabase();
                supabaseInitialized = true;
            } catch (e) {
                console.error('Supabase init failed:', e);
            }
        }
        await initializeSupabase();

        let callbackHandlingInProgress = false;
        let callbackHandled = false;
        async function checkAndHandleCallback() {
            if (callbackHandlingInProgress || callbackHandled) return false;
            if (!supabaseInitialized) await initializeSupabase();
            const supabase = getSupabase();
            if (!supabase) return false;
            const urlParams = new URLSearchParams(window.location.search);
            const urlHash = window.location.hash;
            const hasOAuthParams = urlParams.get('code') || urlParams.get('access_token') || urlHash.includes('access_token') || urlHash.includes('code');
            if (!hasOAuthParams) return false;
            callbackHandlingInProgress = true;
            try {
                await handleGoogleOAuthCallback();
                callbackHandled = true;
                return true;
            } catch (e) {
                console.error('OAuth callback error:', e);
                return false;
            } finally {
                callbackHandlingInProgress = false;
            }
        }

        const handled = await checkAndHandleCallback();
        if (!handled) {
            function setGoogleButtonLabel(text) {
                const el = document.getElementById('googleButtonContent');
                if (el) el.textContent = text;
            }

            const btn = document.getElementById('googleSignInButton');
            const errEl = document.getElementById('googleError');
            if (btn) {
                btn.addEventListener('click', async () => {
                    if (!supabaseInitialized) await initializeSupabase();
                    if (errEl) errEl.textContent = '';
                    btn.disabled = true;
                    setGoogleButtonLabel('Redirecting…');
                    try {
                        await signInWithGoogle();
                    } catch (e) {
                        if (errEl) errEl.textContent = e.message || 'Sign in failed. Try again.';
                        btn.disabled = false;
                        setGoogleButtonLabel('Sign in with Google');
                    }
                });
            }

            if (isDev) {
                const bypassBtn = document.getElementById('devBypassButton');
                const emailInput = document.getElementById('devEmailInput');
                if (bypassBtn && emailInput) {
                    bypassBtn.addEventListener('click', () => {
                        enableDevBypassAuthentication(emailInput.value.trim() || 'dev@test.com');
                        window.location.href = '/src/features/home/presentation/home-page.html';
                    });
                }
            }
        }
    </script>
    <script type="module">
        async function checkForUpdates() {
            try {
                const r = await fetch('/api/version');
                const { hash } = await r.json();
                const cur = document.querySelector('meta[name="app-version"]')?.getAttribute('content');
                if (cur && hash && hash !== cur && confirm('A new version is available. Reload?')) window.location.reload();
            } catch (_) {}
        }
        setInterval(checkForUpdates, 5 * 60 * 1000);
        document.addEventListener('visibilitychange', () => { if (!document.hidden) checkForUpdates(); });
    </script>
    <script type="module" src="/js/auth-checker.js"></script>
</body>
</html>
